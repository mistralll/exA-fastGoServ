# これはなに
実験A最終課題のリポジトリ。
ｸｿﾃﾞｶCSVは重すぎるから .gitingore してます。

# この課題の本質
~~高速化~~ **省メモリ化**  
どうあがいてもファイル全部をそのままラズベリーパイのメモリに乗せることはできない  
* geotag.csv, tag.csv の合計は1.5GBある
* ラズベリーパイのメモリは1GB

# 方針
* 限界までCSVファイルを圧縮する
* サーバーをできるだけ省メモリに作る

# csvの下処理
下処理はノートPCで行い、作成したデータをラズベリーパイに送ります。
1. geotag.csv を id 順に昇順ソートします。
2. geotag.csv の URL を圧縮します。
2. tag.csv に、日付の情報を追加します。（探索には二分探索を使います。）
3. tag.csv を、 **tag** , **日付** の順の優先度でソートします。
4. tag.csv について、同じタグは最大で100件までになるように削除します。
5. tag.csv について、空白のタグの行を削除します。
6. 作成した tag.csv について、場所、URLの情報を加えます。
7. tag.csv について、同じタグが2回以上出現するとき、2回目以降の tag を空白にします。
8. 作成した tag.csv を元に、特定のタグに対して何枚の画像が存在するかをカウントし、別途csvにします。

これらの処理に必要なコードは csvComp パッケージにあります。

# サーバーの設計で工夫した点
* 事前に必要な配列の大きさを計算してプログラムすることで無駄なメモリ確保を防ぐ。
* golang の append や str + str 等の動的にメモリを確保する構文を使用しない。
* tagの探索には二分探索を使用して `` O(logN) `` で行う。
    * しかもこの探索のオーダーはタグの数と等しい。(tag.csvの長さではなく、そこに格納されているタグの種類の数。)
* tagが求まれば画像情報の探索は ``O(1)`` でできるデータ構造。
* ラズベリーパイの仮想メモリを使用。
* 探索中にはラズベリーパイを扇風機で冷却してサーマルスロットリングを抑制。（実際300点くらい上がる）